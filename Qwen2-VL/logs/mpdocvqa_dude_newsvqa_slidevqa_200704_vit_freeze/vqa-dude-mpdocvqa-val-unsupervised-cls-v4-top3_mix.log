+ CHECKPOINT=/gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/
+ DATASET=vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix
+ GPUS=1
+ CHECKPOINT=/gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/
++ pwd
+ export PYTHONPATH=/mntnlp/zqp/physical_report/Qwen2-VL:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public
+ PYTHONPATH=/mntnlp/zqp/physical_report/Qwen2-VL:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public
+ echo 'CHECKPOINT: /gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/'
CHECKPOINT: /gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/
+ MASTER_PORT=57944
+ PORT=62621
+ GPUS=1
+ export MASTER_PORT=57944
+ MASTER_PORT=57944
+ export PORT=62621
+ PORT=62621
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-mpdocvqa-val ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-mpdocvqa-val-unsupervised-cls-v3-top3 ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-mpdocvqa-val-unsupervised-cls-v3-top5 ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-mpdocvqa-val-unsupervised-cls-v4-top3_mix ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-mpdocvqa-val-unsupervised-cls-v4-top5_mix ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-dude-mpdocvqa-val ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top3 ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix == vqa-dude-mpdocvqa-val-unsupervised-cls-v4-top3_mix ']'
+ torchrun --nnodes=1 --node_rank=0 --master_addr=127.0.0.1 --nproc_per_node=1 --master_port=57944 infer_mpdocvqa_dynamic_unsupervised_cls4_multigpu.py --checkpoint /gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/ --datasets dude_mpdocvqa_val --max-pixels-low 200704 --max-pixels-high 802816 --out-dir ./res/dude-mpdoc-vqa --dynamic --select-mode mix_topk --select-image-num 3
datasets: ['dude_mpdocvqa_val']
Unrecognized keys in `rope_scaling` for 'rope_type'='default': {'mrope_section'}
You are attempting to use Flash Attention 2.0 without specifying a torch dtype. This might lead to unexpected behaviour
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:01<00:04,  1.65s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:02<00:02,  1.45s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:04<00:01,  1.37s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:04<00:00,  1.05s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:04<00:00,  1.20s/it]
0it [00:00, ?it/s]1it [00:03,  3.97s/it]2it [00:04,  2.16s/it]3it [00:05,  1.54s/it]4it [00:06,  1.13s/it]5it [00:07,  1.34s/it]6it [00:09,  1.30s/it]7it [00:09,  1.09s/it]8it [00:10,  1.19it/s]9it [00:10,  1.32it/s]10it [00:10,  1.60it/s]11it [00:11,  1.78it/s]12it [00:12,  1.22it/s]13it [00:13,  1.42it/s]14it [00:15,  1.25s/it]15it [00:16,  1.01s/it]16it [00:18,  1.38s/it]17it [00:18,  1.06s/it]18it [00:21,  1.59s/it]19it [00:23,  1.69s/it]20it [00:24,  1.34s/it]21it [00:25,  1.27s/it]22it [00:25,  1.01it/s]23it [00:26,  1.01it/s]24it [00:27,  1.11it/s]25it [00:27,  1.38it/s]26it [00:28,  1.48it/s]27it [00:29,  1.02s/it]28it [00:30,  1.16it/s]29it [00:30,  1.38it/s]30it [00:31,  1.27it/s]31it [00:32,  1.35it/s]32it [00:33,  1.35it/s]33it [00:33,  1.62it/s]34it [00:33,  1.63it/s]35it [00:35,  1.26it/s]36it [00:36,  1.06s/it]37it [00:37,  1.20it/s]38it [00:38,  1.00it/s]39it [00:38,  1.27it/s]40it [00:39,  1.42it/s]41it [00:40,  1.37it/s]42it [00:40,  1.62it/s]43it [00:41,  1.19it/s]44it [00:42,  1.16it/s]45it [00:43,  1.28it/s]46it [00:43,  1.56it/s]W1219 00:04:05.722000 140329475910528 torch/distributed/elastic/agent/server/api.py:688] Received Signals.SIGTERM death signal, shutting down workers
W1219 00:04:05.725000 140329475910528 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 388225 closing signal SIGTERM
