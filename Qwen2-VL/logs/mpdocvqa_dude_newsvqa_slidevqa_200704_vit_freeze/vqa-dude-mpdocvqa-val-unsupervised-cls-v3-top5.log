+ CHECKPOINT=/gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/
+ DATASET=vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5
+ GPUS=1
+ CHECKPOINT=/gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/
++ pwd
+ export PYTHONPATH=/mntnlp/zqp/physical_report/Qwen2-VL:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public
+ PYTHONPATH=/mntnlp/zqp/physical_report/Qwen2-VL:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public:/root/miniconda3/lib/python3.10/site-packages/aistudio_notebook/public
+ echo 'CHECKPOINT: /gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/'
CHECKPOINT: /gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/
+ MASTER_PORT=40965
+ PORT=62621
+ GPUS=1
+ export MASTER_PORT=40965
+ MASTER_PORT=40965
+ export PORT=62621
+ PORT=62621
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-mpdocvqa-val ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-mpdocvqa-val-unsupervised-cls-v3-top3 ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-mpdocvqa-val-unsupervised-cls-v3-top5 ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-mpdocvqa-val-unsupervised-cls-v4-top3_mix ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-mpdocvqa-val-unsupervised-cls-v4-top5_mix ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-dude-mpdocvqa-val ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top3 ']'
+ '[' vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 == vqa-dude-mpdocvqa-val-unsupervised-cls-v3-top5 ']'
+ torchrun --nnodes=1 --node_rank=0 --master_addr=127.0.0.1 --nproc_per_node=1 --master_port=40965 infer_mpdocvqa_dynamic_unsupervised_cls3.py --checkpoint /gruntdata/heyuan67/zqp/qp_lm_models/mpdocvqa_dude_newsvqa_slidevqa_200704_vit_freeze/1e-6/qwen2-vl-7b-instruct/v1-20241216-143438/checkpoint-9434/ --datasets dude_mpdocvqa_val --max-pixels-low 200704 --max-pixels-high 802816 --out-dir ./res/dude-mpdoc-vqa --dynamic --select-mode topk --select-image-num 5
datasets: ['dude_mpdocvqa_val']
Unrecognized keys in `rope_scaling` for 'rope_type'='default': {'mrope_section'}
You are attempting to use Flash Attention 2.0 with a model not initialized on GPU. Make sure to move the model to GPU after initializing it on CPU with `model.to('cuda')`.
You are attempting to use Flash Attention 2.0 without specifying a torch dtype. This might lead to unexpected behaviour
`Qwen2VLRotaryEmbedding` can now be fully parameterized by passing the model config through the `config` argument. All other arguments will be removed in v4.46
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:00,  4.29it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:00<00:00,  4.75it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:00<00:00,  4.69it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00,  4.68it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00,  4.66it/s]
0it [00:00, ?it/s]1it [00:04,  4.25s/it]2it [00:05,  2.28s/it]3it [00:05,  1.61s/it]4it [00:06,  1.15s/it]5it [00:08,  1.52s/it]6it [00:10,  1.54s/it]7it [00:10,  1.25s/it]8it [00:11,  1.05it/s]9it [00:11,  1.20it/s]10it [00:12,  1.48it/s]11it [00:12,  1.69it/s]12it [00:13,  1.21it/s]13it [00:14,  1.42it/s]14it [00:17,  1.49s/it]15it [00:17,  1.17s/it]16it [00:20,  1.60s/it]17it [00:20,  1.22s/it]18it [00:23,  1.67s/it]19it [00:25,  1.87s/it]20it [00:26,  1.47s/it]21it [00:27,  1.45s/it]22it [00:28,  1.11s/it]23it [00:29,  1.17s/it]24it [00:30,  1.02s/it]25it [00:30,  1.25it/s]26it [00:31,  1.36it/s]27it [00:33,  1.15s/it]28it [00:33,  1.06it/s]29it [00:34,  1.28it/s]30it [00:35,  1.16it/s]31it [00:35,  1.26it/s]32it [00:36,  1.30it/s]33it [00:36,  1.57it/s]34it [00:37,  1.58it/s]35it [00:38,  1.10it/s]36it [00:40,  1.24s/it]37it [00:41,  1.05it/s]38it [00:42,  1.17s/it]39it [00:43,  1.10it/s]40it [00:43,  1.27it/s]W1219 00:04:05.722000 139949273025408 torch/distributed/elastic/agent/server/api.py:688] Received Signals.SIGTERM death signal, shutting down workers
W1219 00:04:05.725000 139949273025408 torch/distributed/elastic/multiprocessing/api.py:858] Sending process 388219 closing signal SIGTERM
